---
title: "tidy data"
author: "Yunting Chiu"
date: "11/1/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
ws01 <- read.csv(file = "../data/Datafiniti_Womens_Shoes_Jun19.csv")
# read other data
wsOld01 <- read.csv(file = "../data/Datafiniti_Womens_Shoes.csv")
wsOld02 <- read.csv(file = "../data/7003_1.csv")  
```

```{r}
# recheck variables
# ws02 %>% 
  # select(which(!(colnames(ws02) %in% colnames(ws01))))

ws %>%
  select(dateAdded, brand, categories, colors, manufacturer,
         prices.amountMax, prices.color, 
         prices.offer, prices.size, sizes,
         ) -> ws

wsOld01 %>%
  select(dateAdded, brand, categories, colors, manufacturer,
         prices.amountMax,  prices.color, 
         prices.offer, prices.size, sizes,
         ) -> wsOld01
  
wsOld02 %>%
  select(dateAdded, brand, categories, colors, manufacturer,
         prices.amountMax,  prices.color, 
         prices.offer, prices.size, sizes,
         )  %>%
  mutate(prices.amountMax = as.numeric(prices.amountMax)
         ) -> wsOld02

# combined all data
ws %>%
bind_rows(wsOld01) %>%
 bind_rows(wsOld02) -> ws

```
```{r}
ws02
```

```{r}
ws %>%
  select(prices.size) %>%
  distinct()
```

```{r}
ws %>%
  # select(prices.size) %>%
  mutate(sizesUS = str_extract(prices.size, "\\d{1,}")) %>%
  filter(!is.na(sizesUS)) -> ws
ws %>%
  distinct(sizesUS) 
# convert Europe sizes to the US sizes
ws %>%
  mutate(sizesUS = recode(sizesUS, "44" = "12",
                                   "43" = "11",
                                   "42" = "11",
                                   "41" = "10", 
                                   "40" = "9",
                                   "39" = "8",
                                   "38" = "7.5",
                                   "37" = "6.5",
                                   "36" = "6",
                                   "35" = "5"
                                   ),
         sizesUS = as.numeric(sizesUS)) -> ws
```

```{r}
# testing
ws %>%
  arrange(desc(sizesUS)) %>%
  distinct(sizesUS)
```

```{r}
ws %>%
  mutate(free.shipping = ifelse(str_length(prices.shipping) > 0, "NotFree", "Free"))%>%
  separate(col = prices.offer, into = c("channel", "discount"), sep = ":")%>%
  mutate(discount = ifelse(is.na(discount), 0, as.numeric(substr(discount, 1, str_length(discount)-5))/100)) %>%
  mutate(channel = ifelse(substr(channel, 1, 3) == "Was", "In store only", channel)) -> ws

ws %>%
  count(colors) %>%
  arrange(desc(n))
#color 
#fct_lump()
```

